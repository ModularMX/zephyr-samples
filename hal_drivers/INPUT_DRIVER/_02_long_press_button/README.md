# Long Press Button Detection

This example demonstrates how to detect short and long button presses using Zephyr's `zephyr,input-longpress` driver.

## What Does This Example Do?

The program detects two types of button events:
- **Short press**: When you press and release the button quickly (< 1 second)
- **Long press**: When you hold the button down for 1 second or more

Each type of press generates a different event that you can capture in your application.

## What is the `zephyr,input-longpress` Driver?

`zephyr,input-longpress` is a **pseudo-device** in Zephyr. Unlike traditional hardware drivers that directly control a physical peripheral, a pseudo-device acts as an event processing layer.

### How Does It Work?

1. **Monitors input events**: The driver listens to events generated by another input device (like `gpio-keys`)
2. **Measures time**: When it detects a button press, it starts an internal timer
3. **Generates different events**:
   - If the button is released **before** the configured threshold → generates a "short press" event
   - If the button remains pressed **longer** than the threshold → generates a "long press" event

### Advantages

- ✅ **No manual timing code required**: The driver handles everything automatically
- ✅ **Devicetree configuration**: Configured declaratively, no C code needed
- ✅ **Zero CPU consumption when idle**: Works with interrupts, just like the INPUT subsystem
- ✅ **Multi-button support**: Can handle multiple buttons with different codes

## Devicetree Configuration

### Basic Example (One Button)

```dts
/ {
    buttons {
        compatible = "gpio-keys";
        button0: button_0 {
            gpios = <&gpio0 18 (GPIO_PULL_UP | GPIO_ACTIVE_LOW)>;
            zephyr,code = <INPUT_KEY_0>;
        };
    };

    longpress {
        compatible = "zephyr,input-longpress";
        input = <&buttons>;
        input-codes = <INPUT_KEY_0>;      // Original button code
        short-codes = <INPUT_KEY_A>;      // Code for short press
        long-codes = <INPUT_KEY_X>;       // Code for long press
        long-delay-ms = <1000>;           // 1 second threshold
    };
};
```

### Property Explanation

| Property | Type | Description |
|----------|------|-------------|
| `input` | phandle | Reference to the input device to monitor (optional) |
| `input-codes` | array | Original button codes to detect |
| `short-codes` | array | Codes to emit for short presses (optional) |
| `long-codes` | array | Codes to emit for long presses |
| `long-delay-ms` | int | Time in milliseconds to consider a press as "long" |

### Multi-Button Example

```dts
longpress {
    compatible = "zephyr,input-longpress";
    input = <&buttons>;
    input-codes = <INPUT_KEY_0>, <INPUT_KEY_1>;     // Two buttons
    short-codes = <INPUT_KEY_A>, <INPUT_KEY_B>;     // Short codes (1:1 mapping)
    long-codes = <INPUT_KEY_X>, <INPUT_KEY_Y>;      // Long codes (1:1 mapping)
    long-delay-ms = <1000>;
};
```

The arrays map **positionally**:
- `INPUT_KEY_0` (index 0) → `INPUT_KEY_A` (short) / `INPUT_KEY_X` (long)
- `INPUT_KEY_1` (index 1) → `INPUT_KEY_B` (short) / `INPUT_KEY_Y` (long)


## Kconfig Configuration

Make sure to enable the driver in `prj.conf`:

```ini
CONFIG_GPIO=y
CONFIG_INPUT=y
CONFIG_INPUT_LONGPRESS=y  # Important!
```

## Hardware Setup

### XIAO ESP32C6
- **Button**: GPIO18 with internal pull-up
- **Configuration**: GPIO_ACTIVE_LOW (pressing connects to GND)
- **Status**: ✅ Works perfectly

### STM32H573I-DK

⚠️ **IMPORTANT NOTE**: The onboard button on the STM32H573I-DK board had issues during testing. The behavior was erratic with multiple spurious events.

**Solution**: Use an external button connected to the Arduino pins:
- **Pin**: Arduino D0 (PB10)
- **Configuration**: GPIO_PULL_UP + GPIO_ACTIVE_LOW
- **Connection**: 
  - One button terminal → PB10 (Arduino D0)
  - Other terminal → GND
- **Status**: ✅ Works perfectly with external button

## Use Cases

- **User interfaces**: Menus with short/long press options
- **Device control**: Quick power on vs. reset (hold down)
- **Security**: Confirmation of critical actions with long press
- **Pin savings**: Multiple functions on a single button

## Additional Resources

- [Zephyr INPUT Subsystem Documentation](https://docs.zephyrproject.org/latest/hardware/peripherals/input.html)
- [Input Longpress Driver Binding](zephyr/dts/bindings/input/zephyr,input-longpress.yaml)
- [GPIO Keys Driver](zephyr/dts/bindings/input/gpio-keys.yaml)
